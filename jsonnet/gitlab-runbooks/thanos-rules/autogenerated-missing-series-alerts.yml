# WARNING. DO NOT EDIT THIS FILE BY HAND. USE ./thanos-rules-jsonnet/general-missing-series-alerts.jsonnet TO GENERATE IT
# YOUR CHANGES WILL BE OVERRIDDEN
groups:
- name: missing_series_alerts.rules
  partial_response_strategy: warn
  rules:
  - alert: gitlab_component_opsrate_missing_series
    for: 1h
    annotations:
      title: Operation rate data for the `{{ $labels.component }}` component of the
        `{{ $labels.type }}` service (`{{ $labels.stage }}` stage) is missing
      description: |
        The data used to generate the `gitlab_component_ops:rate` metrics are missing for the `{{ $labels.component }}` component of the `{{ $labels.type }}` service. This might indicate that our observability has been affected.
      grafana_dashboard_id: alerts-component_opsrate_missing/alerts-component-request-rate-series-missing
      grafana_dashboard_link: https://dashboards.gitlab.net/d/alerts-component_opsrate_missing/alerts-component-request-rate-series-missing?from=now-24h/m&to=now-1m/m&var-environment={{
        $labels.environment }}&var-type={{ $labels.type }}&var-component={{ $labels.component
        }}&var-stage={{ $labels.stage }}
      grafana_min_zoom_hours: "24"
      grafana_panel_id: "803754892"
      grafana_variables: environment,type,component,stage
    labels:
      alert_type: cause
      rules_domain: general
      severity: s4
    expr: |
      (
        sum by (env, environment, tier, type, stage, component) (
          gitlab_component_ops:rate{monitor!="global"} offset 1d >= 0
        )
        unless
        sum by (env, environment, tier, type, stage, component) (
          gitlab_component_ops:rate{monitor!="global"} >= 0
        )
      )
      and on (type, component)
      gitlab_component_service:mapping{monitor="global"}
  - alert: gitlab_component_apdex_missing_series
    for: 1h
    annotations:
      title: Apdex for the `{{ $labels.component }}` component of the `{{ $labels.type
        }}` service (`{{ $labels.stage }}` stage) is missing
      description: |
        The data used to generate the `gitlab_component_apdex:ratio` metrics are missing for the `{{ $labels.component }}` component of the `{{ $labels.type }}` service. This might indicate that our observability has been affected.
      grafana_dashboard_id: alerts-component_opsrate_missing/alerts-component-request-rate-series-missing
      grafana_dashboard_link: https://dashboards.gitlab.net/d/alerts-component_opsrate_missing/alerts-component-request-rate-series-missing?from=now-24h/m&to=now-1m/m&var-environment={{
        $labels.environment }}&var-type={{ $labels.type }}&var-component={{ $labels.component
        }}&var-stage={{ $labels.stage }}
      grafana_min_zoom_hours: "24"
      grafana_panel_id: "803754892"
      grafana_variables: environment,type,component,stage
    labels:
      alert_type: cause
      rules_domain: general
      severity: s4
    expr: |
      (
        sum by (env, environment, tier, type, stage, component) (
          gitlab_component_apdex:ratio{monitor="global"} offset 1d >= 0
        )
        unless
        sum by (env, environment, tier, type, stage, component) (
          gitlab_component_apdex:ratio{monitor="global"}
        )
      )
      and on (type, component)
      gitlab_component_service:mapping{monitor="global"}
  - alert: gitlab_component_error_missing_series
    for: 2h
    annotations:
      title: Error rate data for the `{{ $labels.component }}` component of the `{{
        $labels.type }}` service (`{{ $labels.stage }}` stage) is missing
      description: |
        The data used to generate the `gitlab_component_errors:rate` metrics are missing for the `{{ $labels.component }}` component of the `{{ $labels.type }}` service. This might indicate that our observability has been affected.
      grafana_dashboard_id: alerts-component_error_missing/alerts-component-error-rate-series-missing
      grafana_dashboard_link: https://dashboards.gitlab.net/d/alerts-component_error_missing/alerts-component-error-rate-series-missing?from=now-24h/m&to=now-1m/m&var-environment={{
        $labels.environment }}&var-type={{ $labels.type }}&var-component={{ $labels.component
        }}&var-stage={{ $labels.stage }}
      grafana_min_zoom_hours: "24"
      grafana_panel_id: "803754892"
      grafana_variables: environment,type,component,stage
    labels:
      alert_type: cause
      rules_domain: general
      severity: s4
    expr: |
      (
        sum by (env, environment, tier, type, stage, component) (
          (gitlab_component_errors:rate{monitor!="global", stage!="cny"} offset 1d)
        )
        unless
        sum by (env, environment, tier, type, stage, component) (
          gitlab_component_errors:rate{monitor!="global", stage!="cny"}
        )
      )
      and on (type, component)
      gitlab_component_service:mapping{monitor="global"}
