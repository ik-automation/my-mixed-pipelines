.PHONY: default
default: generate

.PHONY: generate
generate: vendor generate-ci-config

jsonnetfile.lock.json: jsonnetfile.json
	jb update

.PHONY: vendor-jsonnet
vendor-jsonnet: jsonnetfile.lock.json
	jb install


.PHONY: generate-ci-config
generate-ci-config:
	( \
		printf -- '---\n\n# Generated by "make generate-ci-config"\n# Do not edit!!\n\n'; \
		jsonnet --string .gitlab-ci.jsonnet | yq e -P - \
	) > .gitlab-ci.yml
